COPY	START	1000
FIRST	STL		RETADR
CLOOP	JSUB	RDREC
		LDA		LENGTH
		COMP	ZERO
		JEQ 	ENDFIL
		JSUB 	WRREC
		J 		CLOOP
ENDFIL 	LDA 	EOF
		STA		BUFFER
		LDA		THREE
		STA		LENGTH
		JSUB	WRREC
		LDL		RETADR
		RSUB	
EOF		BYTE	C'EOF'
		LDA		=C'EOF'
		LDA		=X'02'
		LTORG
THREE	WORD	3
ZERO	WORD	0
RETADR	RESW	1
LENGTH 	RESW	1
BUFFER	RESB	4096
RDREC	LDX 	ZERO
	LDA	ZERO
	USE TEST1
RLOOP	TD	INPUT
	JEQ	RLOOP
	RD	INPUT
	USE TEST2
	COMP	ZERO
	LDA		=C'POP'
	JEQ	EXIT
	LTORG
	STCH	BUFFER,X 
	TIX	MAXLEN
TEST3	JLT	RLOOP
	USE 
EXIT	STX	LENGTH
	RSUB 
	ORG		BUFFER
INPUT 	BYTE 	X'F1'
MAXLEN 	WORD 	4096
WRREC	LDX	ZERO
WLOOP 	TD 	OUTPUT
	JEQ 	WLOOP
	LDCH 	BUFFER,X
	WD 	OUTPUT
	TIX 	LENGTH
	JLT 	WLOOP
	RSUB
	+LDT	31
OUTPUT 	BYTE 	X'05'
	END 	FIRST